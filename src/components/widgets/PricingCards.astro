---
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import Headline from '~/components/ui/Headline.astro';
import Button from '~/components/ui/Button.astro';
import { Icon } from 'astro-icon/components';

const {
  title = '',
  subtitle = '',
  tagline = '',
  packages = [],
  id,
  isDark = false,
  classes = {},
  bg = await Astro.slots.render('bg'),
} = Astro.props;
---

<WidgetWrapper id={id} isDark={isDark} containerClass={`max-w-7xl mx-auto ${classes?.container ?? ''}`} bg={bg}>
  <Headline title={title} subtitle={subtitle} tagline={tagline} />

  <div class="grid gap-8 grid-cols-1 md:grid-cols-2 lg:grid-cols-3 items-stretch">
    {
      packages.map((pkg) => (
        <div
          class={`relative rounded-3xl overflow-hidden flex flex-col h-full ${
            pkg.isPopular
              ? 'bg-gradient-to-br from-primary to-accent shadow-2xl'
              : 'bg-inherit border border-primary shadow-lg hover:shadow-xl transition-shadow duration-300'
          }`}
        >
          <!-- Card Header Section -->
          <div class={`px-6 py-4 ${
            pkg.isPopular 
              ? 'bg-white/10 backdrop-blur-sm border-b border-white/20' 
              : 'bg-gradient-to-r from-primary/5 to-accent/5 border-b border-gray-200 dark:border-gray-700'
          }`}>
            <div class="flex items-center justify-between">
              <!-- Plan Title -->
              <div class={`text-sm font-semibold uppercase tracking-wider ${
                pkg.isPopular ? 'text-white/90' : 'text-gray-600 dark:text-gray-300'
              }`}>
                {pkg.title}
              </div>
              
              <!-- Badge Section -->
              {pkg.isPopular ? (
                <div class="flex items-center">
                  <Icon name="tabler:star-filled" class="w-4 h-4 text-yellow-400 mr-1" />
                  <span class="text-white text-xs font-medium bg-white/20 px-3 py-1 rounded-full border border-white/30 backdrop-blur-sm">
                    MOST POPULAR
                  </span>
                </div>
              ) : (
                null
              )}
            </div>
          </div>

          <!-- Card Content -->
          <div class="p-6 flex flex-col flex-grow">
            <!-- Price Section -->
            <div class="mb-4">
              <div class={`text-4xl font-bold mb-3 ${
                pkg.isPopular ? 'text-white' : 'text-gray-900 dark:text-white'
              }`}>
                {pkg.price || 'Contact Us'}
              </div>

              <p class={`text-base leading-relaxed ${
                pkg.isPopular ? 'text-white/90' : 'text-gray-600 dark:text-gray-300'
              }`}>
                {pkg.description}
              </p>
            </div>

            <!-- Features List -->
            <div class="flex-grow space-y-3 mb-6">
              {pkg.features?.map((feature) => (
                <div class="flex items-center">
                  <div class={`flex-shrink-0 w-4 h-4 rounded-full flex items-center justify-center mr-3 ${
                    pkg.isPopular 
                      ? 'bg-transparent border border-white' 
                      : 'bg-primary border-2 border-primary'
                  }`}>
                    <Icon 
                      name="tabler:check" 
                      class={`w-2.5 h-2.5 font-bold ${
                        pkg.isPopular ? 'text-white' : 'text-white'
                      }`} 
                    />
                  </div>
                  <span class={`text-base leading-relaxed ${
                    pkg.isPopular ? 'text-white/95' : 'text-gray-700 dark:text-gray-200'
                  }`}>
                    {feature}
                  </span>
                </div>
              ))}
            </div>

            <!-- CTA Button -->
            <div class="mt-auto">
              <Button
                variant={pkg.isPopular ? "primary" : "secondary"}
                class={`w-full justify-center rounded-xl py-3 text-base font-medium transition-all duration-300 transform hover:scale-105 ${
                  pkg.isPopular
                    ? '!bg-transparent !border-2 !border-white !text-white hover:!bg-white hover:!text-primary shadow-lg hover:shadow-xl'
                    : 'bg-transparent border-2 border-primary text-primary hover:bg-primary hover:text-white shadow-md hover:shadow-lg'
                }`}
                {...(pkg.callToAction || {})}
              >
                {pkg.callToAction?.text || 'Get Started'}
              </Button>
            </div>
          </div>

          <!-- Subtle Background Pattern for Non-Popular Cards -->
          {!pkg.isPopular && (
            <div class="absolute inset-0 bg-gradient-to-br from-transparent via-primary/5 to-accent/5 opacity-0 hover:opacity-100 transition-opacity duration-500 pointer-events-none rounded-3xl"></div>
          )}
        </div>
      ))
    }
  </div>

  {
    packages.some((pkg) => pkg.note) && (
      <div class="mt-12 text-center">
        <p class="text-gray-500 dark:text-gray-400 text-base">
          * {packages.find((pkg) => pkg.note)?.note}
        </p>
      </div>
    )
  }
</WidgetWrapper>